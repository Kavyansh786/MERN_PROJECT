<!DOCTYPE html>
<html>
<head>
  <title>Test API - Artificial Jewellery</title>
</head>
<body>
  <h1>API Testing Page</h1>

  <!-- Register -->
  <h2>Register User</h2>
  <form id="registerForm">
    <input type="text" placeholder="Name" name="name" required>
    <input type="email" placeholder="Email" name="email" required>
    <input type="password" placeholder="Password" name="password" required>
    <button type="submit">Register</button>
  </form>

  <!-- Login -->
  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" placeholder="Email" name="email" required>
    <input type="password" placeholder="Password" name="password" required>
    <button type="submit">Login</button>
  </form>

  <!-- Profile -->
  <h2>Get Profile</h2>
  <button onclick="getProfile()">Get Profile</button>

  <!-- Products -->
  <h2>Get All Products</h2>
  <button onclick="getProducts()">Get Products</button>

  <!-- Create Product -->
  <h2>Create Product</h2>
  <form id="productForm">
    <input type="text" placeholder="Name" name="name">
    <input type="number" placeholder="Price" name="price">
    <input type="text" placeholder="Category" name="category">
    <input type="text" placeholder="Image URL" name="imageUrl">
    <input type="text" placeholder="Description" name="description">
    <button type="submit">Create Product</button>
  </form>

  <!-- Cart -->
  <h2>Cart</h2>
  <input type="text" id="cartProductId" placeholder="Product ID">
  <input type="number" id="cartQuantity" placeholder="Quantity" value="1">
  <button onclick="addToCart()">Add to Cart</button>
  <button onclick="getCart()">View Cart</button>

  <!-- Orders -->
  <h2>Orders</h2>
  <button onclick="createOrder()">Place Order (from cart)</button>
  <button onclick="getMyOrders()">My Orders</button>

  <pre id="output"></pre>

  <script>
    const api = 'http://localhost:5000/api';
    const testUserId = '662f1b8e3c8c7e1e94650a20'; // used by backend

    function show(result) {
      document.getElementById('output').textContent = JSON.stringify(result, null, 2);
    }

    document.getElementById('registerForm').addEventListener('submit', async e => {
      e.preventDefault();
      const form = e.target;
      const body = {
        name: form.name.value,
        email: form.email.value,
        password: form.password.value
      };
      const res = await fetch(`${api}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      show(data);
    });

    document.getElementById('loginForm').addEventListener('submit', async e => {
      e.preventDefault();
      const form = e.target;
      const body = {
        email: form.email.value,
        password: form.password.value
      };
      const res = await fetch(`${api}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      show(data);
    });

    async function getProfile() {
      const res = await fetch(`${api}/users/profile`);
      const data = await res.json();
      show(data);
    }

    async function getProducts() {
      const res = await fetch(`${api}/products`);
      const data = await res.json();
      show(data);
    }

    document.getElementById('productForm').addEventListener('submit', async e => {
      e.preventDefault();
      const form = e.target;
      const body = {
        name: form.name.value,
        price: parseInt(form.price.value),
        category: form.category.value,
        imageUrl: form.imageUrl.value,
        description: form.description.value
      };
      const res = await fetch(`${api}/products`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      show(data);
    });

    async function addToCart() {
      const productId = document.getElementById('cartProductId').value;
      const quantity = parseInt(document.getElementById('cartQuantity').value);
      const res = await fetch(`${api}/cart`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId, quantity })
      });
      const data = await res.json();
      show(data);
    }

    async function getCart() {
      const res = await fetch(`${api}/cart`);
      const data = await res.json();
      show(data);
    }

    async function createOrder() {
      const cartRes = await fetch(`${api}/cart`);
      const cart = await cartRes.json();

      const orderItems = cart.items.map(item => ({
        product: item.product._id,
        quantity: item.quantity
      }));

      const res = await fetch(`${api}/orders`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          orderItems,
          shippingAddress: {
            address: '123 Main St',
            city: 'Delhi',
            postalCode: '110001',
            country: 'India'
          },
          paymentMethod: 'Cash on Delivery'
        })
      });

      const data = await res.json();
      show(data);
    }

    async function getMyOrders() {
      const res = await fetch(`${api}/orders/my`);
      const data = await res.json();
      show(data);
    }
  </script>
</body>
</html>
